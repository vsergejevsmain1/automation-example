name: JMeter

on: [push]

jobs:
  run-jmeter:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-java@v1
        with:
          java-version: 11
      - run: Invoke-WebRequest -Uri https://archive.apache.org/dist/jmeter/binaries/apache-jmeter-5.2.1.zip -OutFile apache-jmeter-5.2.1.zip
      - run: Expand-Archive -Path apache-jmeter-5.2.1.zip -DestinationPath .
      - run: mv .\apache-jmeter-5.2.1\* .
      - run: Remove-Item .\apache-jmeter-5.2.1 -Recurse
      - run: setx PATH $($Env:Path + ';C:\apache-jmeter-5.2.1\bin')
      - run: jmeter.bat -n -t tests/demo.jmx -l results.jtl
